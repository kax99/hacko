<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Physics Problem Solver</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Physics Problem Solver</h1>
        <div class="section">
            <h2>Select a Chapter</h2>
            <select id="chapterSelect" onchange="showChapterOptions()">
                <option value="" disabled selected>Choose a chapter</option>
                <option value="optics">Optics</option>
                <option value="electricity">Electricity</option>
                <option value="thermodynamics">Thermodynamics</option>
                <option value="mechanics">Mechanics</option>
            </select>
        </div>
        <div id="opticsOptions" class="section" style="display:none;">
            <h2>Optics Problem</h2>
            <select id="opticsProblemSelect" onchange="showOpticsInputs()">
                <option value="" disabled selected>Select a problem</option>
                <option value="lens">Lens Formula (1/f = 1/v - 1/u)</option>
                <option value="mirror">Mirror Formula (1/f = 1/v - 1/u)</option>
                <option value="snell">Snell's Law (n₁ sinθ₁ = n₂ sinθ₂)</option>
                <option value="magnification">Magnification (m = -v/u)</option>
                <option value="lensmaker">Lens Maker's Equation (1/f = (n-1)(1/R₁ - 1/R₂))</option>
            </select>
            <div id="opticsInputs"></div>
        </div>
        <div id="electricityOptions" class="section" style="display:none;">
            <h2>Electricity Problem</h2>
            <select id="electricityProblemSelect" onchange="showElectricityInputs()">
                <option value="" disabled selected>Select a problem</option>
                <option value="ohm">Ohm's Law (V = I * R)</option>
                <option value="power">Power (P = V * I)</option>
                <option value="series">Series Resistance (R_total = R₁ + R₂)</option>
                <option value="parallel">Parallel Resistance (1/R_total = 1/R₁ + 1/R₂)</option>
            </select>
            <div id="electricityInputs"></div>
        </div>
        <div id="thermodynamicsOptions" class="section" style="display:none;">
            <h2>Thermodynamics Problem</h2>
            <select id="thermodynamicsProblemSelect" onchange="showThermodynamicsInputs()">
                <option value="" disabled selected>Select a problem</option>
                <option value="newton">Newton's Law of Cooling (T(t) = Tₐ + (T₀ - Tₐ)e^(-kt))</option>
                <option value="idealgas">Ideal Gas Law (PV = nRT)</option>
                <option value="specificheat">Specific Heat (Q = mcΔT)</option>
                <option value="conduction">Heat Conduction (Q = kAΔTt/d)</option>
            </select>
            <div id="thermodynamicsInputs"></div>
        </div>
        <div id="mechanicsOptions" class="section" style="display:none;">
            <h2>Mechanics Problem</h2>
            <select id="mechanicsProblemSelect" onchange="showMechanicsInputs()">
                <option value="" disabled selected>Select a problem</option>
                <option value="kinematic">Kinematic Equation (v = u + at)</option>
                <option value="workenergy">Work-Energy (W = Fd)</option>
                <option value="newton2">Newton's Second Law (F = ma)</option>
                <option value="energy">Kinetic Energy (KE = ½mv²)</option>
                <option value="potential">Potential Energy (U = mgh)</option>
            </select>
            <div id="mechanicsInputs"></div>
        </div>
        <div id="aiInputSection" class="section">
            <h2>Custom Problem (AI-Powered)</h2>
            <p>If your problem isn't listed, describe it or upload an image below.</p>
            <label for="problemDescription">Problem Description</label>
            <textarea id="problemDescription" placeholder="e.g., A 2 kg object accelerates at 3 m/s². Find the force."></textarea>
            <label for="problemImage">Upload Problem Image</label>
            <input type="file" id="problemImage" accept="image/*">
        </div>
        <button onclick="solveProblem()">Solve Problem</button>
        <div id="steps" class="step-container" style="display:none;"></div>
        <div id="result" class="result" style="display:none;"></div>
    </div>
    <script>
        const API_KEY = 'AIzaSyDWDYMorCylhEfjhSUi-15HMI1A0Dzzk60';
        function showChapterOptions() {
            const chapter = document.getElementById("chapterSelect").value;
            document.getElementById("opticsOptions").style.display = chapter === "optics" ? "block" : "none";
            document.getElementById("electricityOptions").style.display = chapter === "electricity" ? "block" : "none";
            document.getElementById("thermodynamicsOptions").style.display = chapter === "thermodynamics" ? "block" : "none";
            document.getElementById("mechanicsOptions").style.display = chapter === "mechanics" ? "block" : "none";
            document.getElementById("steps").style.display = "none";
            document.getElementById("result").style.display = "none";
        }
        function showOpticsInputs() {
            const problemType = document.getElementById("opticsProblemSelect").value;
            let inputsHtml = "";
            if (problemType === "lens" || problemType === "mirror") {
                inputsHtml += '<label>Object Distance (u)</label><input type="number" id="u" placeholder="in meters">';
                inputsHtml += '<label>Image Distance (v)</label><input type="number" id="v" placeholder="in meters">';
                inputsHtml += '<label>Focal Length (f)</label><input type="number" id="f" placeholder="in meters">';
            } else if (problemType === "snell") {
                inputsHtml += '<label>n₁</label><input type="number" id="n1" placeholder="Refractive index 1">';
                inputsHtml += '<label>θ₁ (degrees)</label><input type="number" id="theta1" placeholder="Angle of incidence">';
                inputsHtml += '<label>n₂</label><input type="number" id="n2" placeholder="Refractive index 2">';
                inputsHtml += '<label>θ₂ (degrees)</label><input type="number" id="theta2" placeholder="Angle of refraction">';
            } else if (problemType === "magnification") {
                inputsHtml += '<label>Image Distance (v)</label><input type="number" id="v_mag" placeholder="in meters">';
                inputsHtml += '<label>Object Distance (u)</label><input type="number" id="u_mag" placeholder="in meters">';
            } else if (problemType === "lensmaker") {
                inputsHtml += '<label>Refractive Index (n)</label><input type="number" id="n_lens" placeholder="e.g., 1.5">';
                inputsHtml += '<label>R₁</label><input type="number" id="R1" placeholder="in meters">';
                inputsHtml += '<label>R₂</label><input type="number" id="R2" placeholder="in meters">';
            }
            document.getElementById("opticsInputs").innerHTML = inputsHtml;
        }
        function showElectricityInputs() {
            const problemType = document.getElementById("electricityProblemSelect").value;
            let inputsHtml = "";
            if (problemType === "ohm") {
                inputsHtml += '<label>Voltage (V)</label><input type="number" id="V" placeholder="in volts">';
                inputsHtml += '<label>Current (I)</label><input type="number" id="I" placeholder="in amperes">';
                inputsHtml += '<label>Resistance (R)</label><input type="number" id="R" placeholder="in ohms">';
            } else if (problemType === "power") {
                inputsHtml += '<label>Voltage (V)</label><input type="number" id="V_pow" placeholder="in volts">';
                inputsHtml += '<label>Current (I)</label><input type="number" id="I_pow" placeholder="in amperes">';
            } else if (problemType === "series") {
                inputsHtml += '<label>R₁</label><input type="number" id="R1_ser" placeholder="in ohms">';
                inputsHtml += '<label>R₂</label><input type="number" id="R2_ser" placeholder="in ohms">';
            } else if (problemType === "parallel") {
                inputsHtml += '<label>R₁</label><input type="number" id="R1_par" placeholder="in ohms">';
                inputsHtml += '<label>R₂</label><input type="number" id="R2_par" placeholder="in ohms">';
            }
            document.getElementById("electricityInputs").innerHTML = inputsHtml;
        }
        function showThermodynamicsInputs() {
            const problemType = document.getElementById("thermodynamicsProblemSelect").value;
            let inputsHtml = "";
            if (problemType === "newton") {
                inputsHtml += '<label>Ambient Temp (Tₐ)</label><input type="number" id="T_ambient" placeholder="in °C">';
                inputsHtml += '<label>Initial Temp (T₀)</label><input type="number" id="T0" placeholder="in °C">';
                inputsHtml += '<label>Cooling Constant (k)</label><input type="number" id="k" placeholder="in s⁻¹">';
                inputsHtml += '<label>Time (t)</label><input type="number" id="time" placeholder="in seconds">';
            } else if (problemType === "idealgas") {
                inputsHtml += '<label>Pressure (P)</label><input type="number" id="P" placeholder="in Pa">';
                inputsHtml += '<label>Volume (V)</label><input type="number" id="V_gas" placeholder="in m³">';
                inputsHtml += '<label>Moles (n)</label><input type="number" id="n" placeholder="in mol">';
            } else if (problemType === "specificheat") {
                inputsHtml += '<label>Mass (m)</label><input type="number" id="m_sh" placeholder="in kg">';
                inputsHtml += '<label>Specific Heat (c)</label><input type="number" id="c" placeholder="in J/kg°C">';
                inputsHtml += '<label>ΔT</label><input type="number" id="deltaT" placeholder="in °C">';
            } else if (problemType === "conduction") {
                inputsHtml += '<label>Thermal Conductivity (k)</label><input type="number" id="k_cond" placeholder="in W/m°C">';
                inputsHtml += '<label>Area (A)</label><input type="number" id="A" placeholder="in m²">';
                inputsHtml += '<label>ΔT</label><input type="number" id="deltaT_cond" placeholder="in °C">';
                inputsHtml += '<label>Time (t)</label><input type="number" id="t_cond" placeholder="in seconds">';
                inputsHtml += '<label>Thickness (d)</label><input type="number" id="d" placeholder="in meters">';
            }
            document.getElementById("thermodynamicsInputs").innerHTML = inputsHtml;
        }
        function showMechanicsInputs() {
            const problemType = document.getElementById("mechanicsProblemSelect").value;
            let inputsHtml = "";
            if (problemType === "kinematic") {
                inputsHtml += '<label>Initial Velocity (u)</label><input type="number" id="u_kin" placeholder="in m/s">';
                inputsHtml += '<label>Acceleration (a)</label><input type="number" id="a_kin" placeholder="in m/s²">';
                inputsHtml += '<label>Time (t)</label><input type="number" id="t_kin" placeholder="in seconds">';
            } else if (problemType === "workenergy") {
                inputsHtml += '<label>Force (F)</label><input type="number" id="F_we" placeholder="in N">';
                inputsHtml += '<label>Distance (d)</label><input type="number" id="d_we" placeholder="in meters">';
            } else if (problemType === "newton2") {
                inputsHtml += '<label>Mass (m)</label><input type="number" id="m_n2" placeholder="in kg">';
                inputsHtml += '<label>Acceleration (a)</label><input type="number" id="a_n2" placeholder="in m/s²">';
            } else if (problemType === "energy") {
                inputsHtml += '<label>Mass (m)</label><input type="number" id="m_ke" placeholder="in kg">';
                inputsHtml += '<label>Velocity (v)</label><input type="number" id="v_ke" placeholder="in m/s">';
            } else if (problemType === "potential") {
                inputsHtml += '<label>Mass (m)</label><input type="number" id="m_pe" placeholder="in kg">';
                inputsHtml += '<label>Height (h)</label><input type="number" id="h_pe" placeholder="in meters">';
            }
            document.getElementById("mechanicsInputs").innerHTML = inputsHtml;
        }
        async function solveProblem() {
            const problemDescription = document.getElementById("problemDescription").value.trim();
            const problemImage = document.getElementById("problemImage").files[0];
            let stepsText = "";
            let resultText = "";
            if (problemDescription || problemImage) {
                await solveWithAI(problemDescription, problemImage);
                return;
            }
            const chapter = document.getElementById("chapterSelect").value;
            if (!chapter) {
                resultText = "Please select a chapter or provide a problem description/image.";
                showResult(resultText, "", true);
                return;
            }
            const problemType = document.getElementById(`${chapter}ProblemSelect`).value;
            if (!problemType) {
                resultText = "Please select a problem type.";
                showResult(resultText, "", true);
                return;
            }
            if (chapter === "optics") {
                if (problemType === "lens" || problemType === "mirror") {
                    let u = parseFloat(document.getElementById("u").value);
                    let v = parseFloat(document.getElementById("v").value);
                    let f = parseFloat(document.getElementById("f").value);
                    if (!isNaN(u) && !isNaN(v)) {
                        f = 1 / ((1 / v) - (1 / u));
                        stepsText = `<div class="step">Using 1/f = 1/v - 1/u</div><div class="step">1/f = 1/${v} - 1/${u}</div>`;
                        resultText = `Focal length (f) = ${f.toFixed(2)} m`;
                    } else if (!isNaN(u) && !isNaN(f)) {
                        v = 1 / ((1 / f) + (1 / u));
                        stepsText = `<div class="step">Using 1/v = 1/f + 1/u</div><div class="step">1/v = 1/${f} + 1/${u}</div>`;
                        resultText = `Image distance (v) = ${v.toFixed(2)} m`;
                    } else if (!isNaN(v) && !isNaN(f)) {
                        u = 1 / ((1 / f) - (1 / v));
                        stepsText = `<div class="step">Using 1/u = 1/f - 1/v</div><div class="step">1/u = 1/${f} - 1/${v}</div>`;
                        resultText = `Object distance (u) = ${u.toFixed(2)} m`;
                    } else {
                        resultText = "Please provide two of: u, v, f.";
                        stepsText = "";
                    }
                } else if (problemType === "snell") {
                    let n1 = parseFloat(document.getElementById("n1").value);
                    let theta1 = parseFloat(document.getElementById("theta1").value);
                    let n2 = parseFloat(document.getElementById("n2").value);
                    let theta2 = parseFloat(document.getElementById("theta2").value);
                    if (isNaN(n1) && !isNaN(theta1) && !isNaN(n2) && !isNaN(theta2)) {
                        n1 = (n2 * Math.sin(theta2 * Math.PI / 180)) / Math.sin(theta1 * Math.PI / 180);
                        stepsText = `<div class="step">Using n₁ sinθ₁ = n₂ sinθ₂</div><div class="step">n₁ = ${n2} sin(${theta2}) / sin(${theta1})</div>`;
                        resultText = `n₁ = ${n1.toFixed(2)}`;
                    } else if (isNaN(theta1) && !isNaN(n1) && !isNaN(n2) && !isNaN(theta2)) {
                        theta1 = Math.asin((n2 * Math.sin(theta2 * Math.PI / 180)) / n1) * 180 / Math.PI;
                        stepsText = `<div class="step">Using sinθ₁ = (n₂ sinθ₂) / n₁</div>`;
                        resultText = `θ₁ = ${theta1.toFixed(2)}°`;
                    } else {
                        resultText = "Provide three of: n₁, θ₁, n₂, θ₂.";
                    }
                } else if (problemType === "magnification") {
                    let v = parseFloat(document.getElementById("v_mag").value);
                    let u = parseFloat(document.getElementById("u_mag").value);
                    if (!isNaN(v) && !isNaN(u)) {
                        let m = -v / u;
                        stepsText = `<div class="step">Using m = -v/u</div><div class="step">m = -${v} / ${u}</div>`;
                        resultText = `Magnification (m) = ${m.toFixed(2)}`;
                    } else {
                        resultText = "Please provide v and u.";
                    }
                } else if (problemType === "lensmaker") {
                    let n = parseFloat(document.getElementById("n_lens").value);
                    let R1 = parseFloat(document.getElementById("R1").value);
                    let R2 = parseFloat(document.getElementById("R2").value);
                    if (!isNaN(n) && !isNaN(R1) && !isNaN(R2)) {
                        let f = 1 / ((n - 1) * ((1 / R1) - (1 / R2)));
                        stepsText = `<div class="step">Using 1/f = (n-1)(1/R₁ - 1/R₂)</div>`;
                        resultText = `Focal length (f) = ${f.toFixed(2)} m`;
                    } else {
                        resultText = "Please provide n, R₁, and R₂.";
                    }
                }
            } else if (chapter === "electricity") {
                if (problemType === "ohm") {
                    let V = parseFloat(document.getElementById("V").value);
                    let I = parseFloat(document.getElementById("I").value);
                    let R = parseFloat(document.getElementById("R").value);
                    if (!isNaN(V) && !isNaN(I)) {
                        R = V / I;
                        stepsText = `<div class="step">Using V = IR</div><div class="step">R = ${V} / ${I}</div>`;
                        resultText = `Resistance (R) = ${R.toFixed(2)} Ω`;
                    } else if (!isNaN(V) && !isNaN(R)) {
                        I = V / R;
                        stepsText = `<div class="step">Using I = V/R</div>`;
                        resultText = `Current (I) = ${I.toFixed(2)} A`;
                    } else if (!isNaN(I) && !isNaN(R)) {
                        V = I * R;
                        stepsText = `<div class="step">Using V = IR</div>`;
                        resultText = `Voltage (V) = ${V.toFixed(2)} V`;
                    } else {
                        resultText = "Provide two of: V, I, R.";
                    }
                } else if (problemType === "power") {
                    let V = parseFloat(document.getElementById("V_pow").value);
                    let I = parseFloat(document.getElementById("I_pow").value);
                    if (!isNaN(V) && !isNaN(I)) {
                        let P = V * I;
                        stepsText = `<div class="step">Using P = VI</div>`;
                        resultText = `Power (P) = ${P.toFixed(2)} W`;
                    } else {
                        resultText = "Provide V and I.";
                    }
                } else if (problemType === "series") {
                    let R1 = parseFloat(document.getElementById("R1_ser").value);
                    let R2 = parseFloat(document.getElementById("R2_ser").value);
                    if (!isNaN(R1) && !isNaN(R2)) {
                        let R_total = R1 + R2;
                        stepsText = `<div class="step">Using R_total = R₁ + R₂</div>`;
                        resultText = `Total Resistance = ${R_total.toFixed(2)} Ω`;
                    } else {
                        resultText = "Provide R₁ and R₂.";
                    }
                } else if (problemType === "parallel") {
                    let R1 = parseFloat(document.getElementById("R1_par").value);
                    let R2 = parseFloat(document.getElementById("R2_par").value);
                    if (!isNaN(R1) && !isNaN(R2)) {
                        let R_total = 1 / ((1 / R1) + (1 / R2));
                        stepsText = `<div class="step">Using 1/R_total = 1/R₁ + 1/R₂</div>`;
                        resultText = `Total Resistance = ${R_total.toFixed(2)} Ω`;
                    } else {
                        resultText = "Provide R₁ and R₂.";
                    }
                }
            } else if (chapter === "thermodynamics") {
                if (problemType === "newton") {
                    let T_ambient = parseFloat(document.getElementById("T_ambient").value);
                    let T0 = parseFloat(document.getElementById("T0").value);
                    let k = parseFloat(document.getElementById("k").value);
                    let t = parseFloat(document.getElementById("time").value);
                    if (!isNaN(T_ambient) && !isNaN(T0) && !isNaN(k) && !isNaN(t)) {
                        let T = T_ambient + (T0 - T_ambient) * Math.exp(-k * t);
                        stepsText = `<div class="step">Using T(t) = Tₐ + (T₀ - Tₐ)e^(-kt)</div>`;
                        resultText = `Temperature (T) = ${T.toFixed(2)} °C`;
                    } else {
                        resultText = "Provide Tₐ, T₀, k, and t.";
                    }
                } else if (problemType === "idealgas") {
                    let P = parseFloat(document.getElementById("P").value);
                    let V = parseFloat(document.getElementById("V_gas").value);
                    let n = parseFloat(document.getElementById("n").value);
                    const R = 8.314;
                    if (!isNaN(P) && !isNaN(V) && !isNaN(n)) {
                        let T = (P * V) / (n * R);
                        stepsText = `<div class="step">Using PV = nRT</div><div class="step">T = PV / (nR)</div>`;
                        resultText = `Temperature (T) = ${T.toFixed(2)} K`;
                    } else {
                        resultText = "Provide P, V, and n.";
                    }
                } else if (problemType === "specificheat") {
                    let m = parseFloat(document.getElementById("m_sh").value);
                    let c = parseFloat(document.getElementById("c").value);
                    let deltaT = parseFloat(document.getElementById("deltaT").value);
                    if (!isNaN(m) && !isNaN(c) && !isNaN(deltaT)) {
                        let Q = m * c * deltaT;
                        stepsText = `<div class="step">Using Q = mcΔT</div>`;
                        resultText = `Heat (Q) = ${Q.toFixed(2)} J`;
                    } else {
                        resultText = "Provide m, c, and ΔT.";
                    }
                } else if (problemType === "conduction") {
                    let k = parseFloat(document.getElementById("k_cond").value);
                    let A = parseFloat(document.getElementById("A").value);
                    let deltaT = parseFloat(document.getElementById("deltaT_cond").value);
                    let t = parseFloat(document.getElementById("t_cond").value);
                    let d = parseFloat(document.getElementById("d").value);
                    if (!isNaN(k) && !isNaN(A) && !isNaN(deltaT) && !isNaN(t) && !isNaN(d)) {
                        let Q = (k * A * deltaT * t) / d;
                        stepsText = `<div class="step">Using Q = (kAΔTt)/d</div>`;
                        resultText = `Heat (Q) = ${Q.toFixed(2)} J`;
                    } else {
                        resultText = "Provide k, A, ΔT, t, and d.";
                    }
                }
            } else if (chapter === "mechanics") {
                if (problemType === "kinematic") {
                    let u = parseFloat(document.getElementById("u_kin").value);
                    let a = parseFloat(document.getElementById("a_kin").value);
                    let t = parseFloat(document.getElementById("t_kin").value);
                    if (!isNaN(u) && !isNaN(a) && !isNaN(t)) {
                        let v = u + a * t;
                        stepsText = `<div class="step">Using v = u + at</div>`;
                        resultText = `Final Velocity (v) = ${v.toFixed(2)} m/s`;
                    } else {
                        resultText = "Provide u, a, and t.";
                    }
                } else if (problemType === "workenergy") {
                    let F = parseFloat(document.getElementById("F_we").value);
                    let d = parseFloat(document.getElementById("d_we").value);
                    if (!isNaN(F) && !isNaN(d)) {
                        let W = F * d;
                        stepsText = `<div class="step">Using W = Fd</div>`;
                        resultText = `Work (W) = ${W.toFixed(2)} J`;
                    } else {
                        resultText = "Provide F and d.";
                    }
                } else if (problemType === "newton2") {
                    let m = parseFloat(document.getElementById("m_n2").value);
                    let a = parseFloat(document.getElementById("a_n2").value);
                    if (!isNaN(m) && !isNaN(a)) {
                        let F = m * a;
                        stepsText = `<div class="step">Using F = ma</div>`;
                        resultText = `Force (F) = ${F.toFixed(2)} N`;
                    } else {
                        resultText = "Provide m and a.";
                    }
                } else if (problemType === "energy") {
                    let m = parseFloat(document.getElementById("m_ke").value);
                    let v = parseFloat(document.getElementById("v_ke").value);
                    if (!isNaN(m) && !isNaN(v)) {
                        let KE = 0.5 * m * v * v;
                        stepsText = `<div class="step">Using KE = ½mv²</div>`;
                        resultText = `Kinetic Energy (KE) = ${KE.toFixed(2)} J`;
                    } else {
                        resultText = "Provide m and v.";
                    }
                } else if (problemType === "potential") {
                    let m = parseFloat(document.getElementById("m_pe").value);
                    let h = parseFloat(document.getElementById("h_pe").value);
                    const g = 9.81;
                    if (!isNaN(m) && !isNaN(h)) {
                        let U = m * g * h;
                        stepsText = `<div class="step">Using U = mgh</div>`;
                        resultText = `Potential Energy (U) = ${U.toFixed(2)} J`;
                    } else {
                        resultText = "Provide m and h.";
                    }
                }
            }
            showResult(resultText, stepsText, !stepsText);
        }
        async function solveWithAI(description, image) {
            let stepsText = "";
            let resultText = "";
            if (!API_KEY) {
                resultText = "AI functionality requires an API key. Using normal solver instead.";
                showResult(resultText, "", true);
                return;
            }
            let requestBody;
            if (description) {
                requestBody = {
                    contents: [{ parts: [{ text: `Solve this physics problem step by step: ${description}` }] }]
                };
            } else if (image) {
                const reader = new FileReader();
                reader.readAsDataURL(image);
                const imageData = await new Promise((resolve) => {
                    reader.onload = () => resolve(reader.result.split(',')[1]);
                });
                requestBody = {
                    contents: [{ parts: [
                        { inline_data: { data: imageData, mime_type: image.type } },
                        { text: "Analyze this physics problem image and solve it step by step." }
                    ] }]
                };
            } else {
                showResult("Please provide a description or image.", "", true);
                return;
            }
            try {
                const response = await fetch('https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify(requestBody)
                });
                if (!response.ok) throw new Error('API request failed');
                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;
                stepsText = `<div class="step"><span class="step-title">AI Solution:</span> ${aiResponse}</div>`;
                showResult("See steps above for the solution.", stepsText);
            } catch (error) {
                showResult("Sorry, I couldn’t solve this problem with AI. Try using the normal solver or rephrasing.", "", true);
            }
        }
        function showResult(resultText, stepsText, isError = false) {
            const resultDiv = document.getElementById("result");
            const stepsDiv = document.getElementById("steps");
            resultDiv.innerHTML = resultText;
            stepsDiv.innerHTML = stepsText;
            resultDiv.className = `result ${isError ? 'error' : ''}`;
            resultDiv.style.display = "block";
            stepsDiv.style.display = stepsText ? "block" : "none";
        }
    </script>
</body>
</html>